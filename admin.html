<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - Colegio El Rosario</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ===== ESTILOS PANEL ADMINISTRATIVO ===== */
        :root {
            --sidebar-width: 250px;
            --header-height: 70px;
            --primary-color: #008ba3;
            --secondary-color: #2e7d32;
            --accent-color: #fbc02d;
            --sidebar-bg: #2c3e50;
            --sidebar-hover: #34495e;
            --light-bg: #f8f9fa;
        }

        body {
            margin: 0;
            padding-top: 0 !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            display: flex;
            min-height: 100vh;
        }

        /* ===== HEADER SUPERIOR ===== */
        .admin-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-logo {
            height: 40px;
            width: auto;
        }

        .header-title h1 {
            font-size: 1.5rem;
            margin: 0;
            font-weight: 600;
        }

        .header-title span {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* ===== MENÚ LATERAL ===== */
        .admin-sidebar {
            position: fixed;
            left: 0;
            top: var(--header-height);
            width: var(--sidebar-width);
            height: calc(100vh - var(--header-height));
            background: var(--sidebar-bg);
            color: white;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 999;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .menu-item {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .menu-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            color: #ecf0f1;
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .menu-link:hover {
            background: var(--sidebar-hover);
            padding-left: 25px;
        }

        .menu-link.active {
            background: var(--primary-color);
            border-left: 4px solid var(--accent-color);
        }

        .menu-icon {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .submenu {
            list-style: none;
            padding: 0;
            margin: 0;
            background: rgba(0,0,0,0.2);
            display: none;
        }

        .submenu.show {
            display: block;
        }

        .submenu-item {
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .submenu-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px 12px 50px;
            color: #bdc3c7;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .submenu-link:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .has-submenu > .menu-link::after {
            content: '▸';
            margin-left: auto;
            transition: transform 0.3s;
        }

        .has-submenu.active > .menu-link::after {
            transform: rotate(90deg);
        }

        /* ===== CONTENIDO PRINCIPAL ===== */
        .admin-main {
            flex: 1;
            margin-left: var(--sidebar-width);
            margin-top: var(--header-height);
            padding: 30px;
            min-height: calc(100vh - var(--header-height));
            transition: margin-left 0.3s;
        }

        .content-header {
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .content-header h2 {
            color: var(--primary-color);
            margin: 0 0 10px 0;
            font-size: 1.8rem;
        }

        .content-header p {
            color: #666;
            margin: 0;
        }

        /* ===== TARJETAS DE CONTENIDO ===== */
        .content-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            border: 1px solid #eee;
        }

        .content-card h3 {
            color: var(--primary-color);
            margin: 0 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-color);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        /* ===== CONTENIDO OCULTO POR DEFECTO ===== */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== FORMULARIOS ===== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 139, 163, 0.1);
        }

        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }

        /* ===== BOTONES ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #006064;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 139, 163, 0.3);
        }

        .btn-success {
            background: var(--secondary-color);
            color: white;
        }

        .btn-success:hover {
            background: #1b5e20;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--accent-color);
            color: #333;
        }

        .btn-warning:hover {
            background: #f9a825;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        /* ===== LISTA DE NOTICIAS ===== */
        .news-list {
            display: grid;
            gap: 20px;
        }

        .news-item {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
        }

        .news-item-content {
            flex: 1;
        }

        .news-item-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .news-item-date {
            font-size: 0.85rem;
            color: #777;
            margin-bottom: 10px;
        }

        .news-item-preview {
            color: #555;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .news-item-actions {
            display: flex;
            gap: 10px;
        }

        /* ===== LISTA DE DOCUMENTOS ===== */
        .docs-list {
            display: grid;
            gap: 15px;
        }

        .doc-item-admin {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #eee;
        }

        .doc-item-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .doc-icon-admin {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .doc-details h4 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            color: #333;
        }

        .doc-details small {
            color: #777;
            font-size: 0.85rem;
        }

        /* ===== VISTAS PREVIAS ===== */
        .preview-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .preview-container {
            background: white;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 25px;
            min-height: 200px;
            overflow-x: auto;
        }

        /* ===== TOGGLE MENÚ PARA MÓVIL ===== */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
        }

        .menu-toggle:hover {
            background: rgba(255,255,255,0.1);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 992px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }

            .admin-sidebar.active {
                transform: translateX(0);
            }

            .admin-main {
                margin-left: 0;
            }

            .menu-toggle {
                display: block;
            }

            .news-item {
                flex-direction: column;
                gap: 15px;
            }

            .news-item-actions {
                align-self: flex-end;
            }
        }

        @media (max-width: 576px) {
            .admin-header {
                padding: 0 15px;
            }

            .header-title h1 {
                font-size: 1.2rem;
            }

            .admin-main {
                padding: 20px 15px;
            }

            .content-card {
                padding: 20px;
            }

            .btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }

        /* ===== PANTALLA DE LOGIN ===== */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a1628 0%, #1a3a5c 40%, #008ba3 100%);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .login-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .login-card {
            background: white;
            border-radius: 16px;
            padding: 45px 40px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            animation: loginSlideUp 0.6s ease;
        }

        @keyframes loginSlideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .login-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #008ba3, #2e7d32);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 2rem;
            color: white;
        }

        .login-card h2 {
            color: #333;
            font-size: 1.6rem;
            margin: 0 0 5px 0;
        }

        .login-card .login-subtitle {
            color: #777;
            font-size: 0.95rem;
            margin-bottom: 30px;
        }

        .login-form .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .login-form .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        .login-form .input-wrapper {
            position: relative;
        }

        .login-form .input-wrapper i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
            font-size: 1rem;
        }

        .login-form .input-wrapper input {
            width: 100%;
            padding: 12px 15px 12px 42px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s, box-shadow 0.3s;
            box-sizing: border-box;
        }

        .login-form .input-wrapper input:focus {
            outline: none;
            border-color: #008ba3;
            box-shadow: 0 0 0 3px rgba(0, 139, 163, 0.15);
        }

        .login-form .toggle-password {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
        }

        .login-form .toggle-password:hover {
            color: #008ba3;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #008ba3, #006e82);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            margin-top: 5px;
        }

        .login-btn:hover {
            background: linear-gradient(135deg, #006e82, #00545f);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 139, 163, 0.3);
        }

        .login-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .login-error {
            background: #fdecea;
            color: #c62828;
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: none;
            border: 1px solid #f5c6cb;
        }

        .login-error.show {
            display: block;
            animation: shake 0.4s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .login-footer {
            margin-top: 25px;
            font-size: 0.85rem;
            color: #999;
        }

        .login-footer a {
            color: #008ba3;
            text-decoration: none;
        }

        .login-footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 480px) {
            .login-card {
                margin: 15px;
                padding: 30px 25px;
            }
        }
    </style>
</head>
<body>
    <!-- ===== PANTALLA DE LOGIN ===== -->
    <div class="login-overlay" id="login-overlay">
        <div class="login-card">
            <div class="login-logo">
                <i class="fas fa-shield-alt"></i>
            </div>
            <h2>Panel Administrativo</h2>
            <p class="login-subtitle">Colegio El Rosario de Itagüí</p>

            <div class="login-error" id="login-error">
                <i class="fas fa-exclamation-circle"></i> 
                <span id="login-error-msg">Credenciales incorrectas</span>
            </div>

            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label class="form-label">Correo electrónico</label>
                    <div class="input-wrapper">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="login-email" placeholder="admin@elrosario.edu.co" required autocomplete="username">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Contraseña</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="login-password" placeholder="••••••••" required autocomplete="current-password">
                        <button type="button" class="toggle-password" id="toggle-password">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <button type="submit" class="login-btn" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </button>
            </form>

            <div class="login-footer">
                <a href="index.html"><i class="fas fa-arrow-left"></i> Volver al sitio web</a>
            </div>
        </div>
    </div>

    <!-- Header Superior -->
    <header class="admin-header">
        <div class="header-left">
            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-title">
                <h1>Colegio El Rosario</h1>
                <span>Panel Administrativo</span>
            </div>
        </div>
        <div class="header-right">
            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <div style="font-weight: 600;">Administrador</div>
                    <div style="font-size: 0.85rem; opacity: 0.9;">admin@elrosario.edu.co</div>
                </div>
            </div>
            <a href="index.html" class="btn btn-warning">
                <i class="fas fa-external-link-alt"></i> Ver Sitio Web
            </a>
            <button class="logout-btn" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Salir
            </button>
        </div>
    </header>

    <!-- Menú Lateral -->
    <aside class="admin-sidebar" id="sidebar">
        <ul class="sidebar-menu">
            <li class="menu-item">
                <a href="#inicio" class="menu-link active" data-content="inicio">
                    <i class="fas fa-home menu-icon"></i>
                    <span>Inicio</span>
                </a>
            </li>
            
            <li class="menu-item has-submenu">
                <a href="#noticias" class="menu-link" data-content="noticias">
                    <i class="fas fa-newspaper menu-icon"></i>
                    <span>Noticias</span>
                </a>
                <ul class="submenu">
                    <li class="submenu-item">
                        <a href="#publicar-noticia" class="submenu-link" data-content="publicar-noticia">
                            <i class="fas fa-plus-circle"></i>
                            <span>Publicar Nueva</span>
                        </a>
                    </li>
                    <li class="submenu-item">
                        <a href="#gestionar-noticias" class="submenu-link" data-content="gestionar-noticias">
                            <i class="fas fa-list"></i>
                            <span>Gestionar Noticias</span>
                        </a>
                    </li>
                </ul>
            </li>
            
            <li class="menu-item has-submenu">
                <a href="#documentos" class="menu-link" data-content="documentos">
                    <i class="fas fa-folder menu-icon"></i>
                    <span>Documentos</span>
                </a>
                <ul class="submenu">
                    <li class="submenu-item">
                        <a href="#subir-documentos" class="submenu-link" data-content="subir-documentos">
                            <i class="fas fa-upload"></i>
                            <span>Subir Documentos</span>
                        </a>
                    </li>
                    <li class="submenu-item">
                        <a href="#gestionar-documentos" class="submenu-link" data-content="gestionar-documentos">
                            <i class="fas fa-cog"></i>
                            <span>Gestionar Documentos</span>
                        </a>
                    </li>
                </ul>
            </li>
            
            <li class="menu-item has-submenu">
                <a href="#academica" class="menu-link" data-content="academica">
                    <i class="fas fa-graduation-cap menu-icon"></i>
                    <span>Académica</span>
                </a>
                <ul class="submenu">
                    <li class="submenu-item">
                        <a href="#oferta-academica" class="submenu-link" data-content="oferta-academica">
                            <i class="fas fa-book-open"></i>
                            <span>Oferta Académica</span>
                        </a>
                    </li>
                    <li class="submenu-item">
                        <a href="#plan-estudios" class="submenu-link" data-content="plan-estudios">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Plan de Estudios</span>
                        </a>
                    </li>
                    <li class="submenu-item">
                        <a href="#evaluacion" class="submenu-link" data-content="evaluacion">
                            <i class="fas fa-chart-bar"></i>
                            <span>Evaluación y Promoción</span>
                        </a>
                    </li>
                    <li class="submenu-item">
                        <a href="#proyectos" class="submenu-link" data-content="proyectos">
                            <i class="fas fa-project-diagram"></i>
                            <span>Proyectos Pedagógicos</span>
                        </a>
                    </li>
                    <li class="submenu-item">
                        <a href="#actualidad-academica" class="submenu-link" data-content="actualidad-academica">
                            <i class="fas fa-bullhorn"></i>
                            <span>Actualidad Académica</span>
                        </a>
                    </li>
                </ul>
            </li>
            
            <li class="menu-item">
                <a href="#configuracion" class="menu-link" data-content="configuracion">
                    <i class="fas fa-cog menu-icon"></i>
                    <span>Configuración</span>
                </a>
            </li>

            <li class="menu-item" data-permission="pqrs">
                <a href="#pqrs" class="menu-link" data-content="pqrs">
                    <i class="fas fa-headset menu-icon"></i>
                    <span>PQRS</span>
                </a>
            </li>

            <li class="menu-item has-submenu">
                <a href="#gestion-admin" class="menu-link" data-content="gestion-admin">
                    <i class="fas fa-users-cog menu-icon"></i>
                    <span>Gestión Administrativa</span>
                </a>
                <ul class="submenu">
                    <li class="submenu-item">
                        <a href="#docentes" class="submenu-link" data-content="docentes">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>Docentes</span>
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </aside>

    <!-- Contenido Principal (SOLO UNA SECCIÓN VISIBLE A LA VEZ) -->
    <main class="admin-main" id="main-content">
        <!-- Vista: Inicio -->
        <section class="content-section active" id="inicio-content">
            <div class="content-header">
                <h2>Panel de Control</h2>
                <p>Bienvenido al panel administrativo del Colegio El Rosario</p>
            </div>
            
            <div class="content-card">
                <h3><i class="fas fa-chart-line"></i> Estadísticas</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: #e8f5e9; border-radius: 8px;">
                        <div id="stat-noticias" style="font-size: 2rem; font-weight: bold; color: var(--secondary-color);">-</div>
                        <div>Noticias Publicadas</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #e3f2fd; border-radius: 8px;">
                        <div id="stat-documentos" style="font-size: 2rem; font-weight: bold; color: var(--primary-color);">-</div>
                        <div>Documentos Subidos</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #fff3e0; border-radius: 8px;">
                        <div id="stat-docentes" style="font-size: 2rem; font-weight: bold; color: var(--accent-color);">-</div>
                        <div>Docentes Activos</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #fce4ec; border-radius: 8px;">
                        <div id="stat-usuarios" style="font-size: 2rem; font-weight: bold; color: #c0392b;">-</div>
                        <div>Usuarios Activos</div>
                    </div>
                    <div style="text-align: center; padding: 20px; background: #fef9e7; border-radius: 8px; cursor:pointer;" onclick="showContent('pqrs')">
                        <div id="stat-pqrs" style="font-size: 2rem; font-weight: bold; color: #e67e22;">-</div>
                        <div>PQRS Pendientes</div>
                    </div>
                </div>
            </div>
            
            <div class="content-card">
                <h3><i class="fas fa-history"></i> Actividad Reciente</h3>
                <div id="actividad-list" style="max-height: 400px; overflow-y: auto;">
                    <div style="text-align: center; padding: 20px; color: #777;">
                        <i class="fas fa-spinner fa-spin"></i> Cargando actividad...
                    </div>
                </div>
            </div>
        </section>

        <!-- Modal de Detalles de Actividad -->
        <div id="actividad-modal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center;">
            <div style="background:white; border-radius:12px; max-width:500px; width:90%; max-height:80vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,0.3);">
                <div style="padding:20px 25px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0; color:var(--primary-color); font-size:1.1rem;"><i class="fas fa-info-circle"></i> Detalles de Actividad</h3>
                    <button onclick="closeActividadModal()" style="background:none; border:none; font-size:1.5rem; cursor:pointer; color:#999; line-height:1;">&times;</button>
                </div>
                <div id="actividad-modal-body" style="padding:25px;">
                </div>
            </div>
        </div>

        <!-- Vista: Publicar Noticia -->
        <section class="content-section" id="publicar-noticia-content">
            <div class="content-header">
                <h2><i class="fas fa-plus-circle"></i> Publicar Nueva Noticia</h2>
                <p>Crea y publica noticias para mostrar en el sitio web</p>
            </div>
            
            <div class="content-card">
                <form id="news-form">
                    <div class="form-group">
                        <label class="form-label">Título de la Noticia *</label>
                        <input type="text" class="form-control" id="news-title" placeholder="Ej: Inicio de Clases 2026" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contenido *</label>
                        <textarea class="form-control" id="news-content" rows="8" placeholder="Escribe el contenido completo de la noticia aquí..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-image"></i> Imagen de la Noticia (opcional)</label>
                        <div id="news-image-drop" style="border: 2px dashed #ccc; border-radius: 8px; padding: 25px; text-align: center; cursor: pointer; transition: all 0.3s; background: #fafafa;">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #aaa; display: block; margin-bottom: 8px;"></i>
                            <span style="color: #777;">Arrastra una imagen aquí o <strong style="color: var(--primary-color);">haz clic para seleccionar</strong></span>
                            <br><small style="color: #999;">Formatos: JPG, PNG, GIF, WEBP</small>
                            <input type="file" id="news-image" accept="image/jpeg,image/png,image/gif,image/webp" style="display: none;">
                        </div>
                        <div id="news-image-preview" style="display: none; margin-top: 10px; position: relative;">
                            <img id="news-image-thumb" src="" style="max-height: 150px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <button type="button" id="news-image-remove" style="position: absolute; top: -8px; right: -8px; background: #e74c3c; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 0.8rem; line-height: 24px;"><i class="fas fa-times"></i></button>
                        </div>
                        <small style="color: #777;">Si no subes imagen, se mostrará una imagen predeterminada del colegio</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label"><i class="fas fa-paperclip"></i> Archivo Adjunto (opcional)</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                <i class="fas fa-file-upload" style="color: var(--primary-color);"></i>
                                <span>Seleccionar archivo</span>
                                <input type="file" id="news-attachment" accept=".pdf,.doc,.docx,.xls,.xlsx" style="display: none;">
                            </label>
                            <span id="news-attachment-name" style="color: #777; font-size: 0.9rem;">Ningún archivo seleccionado</span>
                            <button type="button" id="news-attachment-remove" style="display: none; background: none; border: none; color: #e74c3c; cursor: pointer; font-size: 1.1rem;"><i class="fas fa-times-circle"></i></button>
                        </div>
                        <small style="color: #777;">Formatos: PDF, Word, Excel</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Categoría</label>
                        <select class="form-control" id="news-category">
                            <option value="general">General</option>
                            <option value="academico">Académico</option>
                            <option value="eventos">Eventos</option>
                            <option value="anuncios">Anuncios</option>
                        </select>
                    </div>
                    
                    <div class="preview-section">
                        <div class="preview-header">
                            <h4><i class="fas fa-eye"></i> Vista Previa</h4>
                            <button type="button" class="btn btn-sm btn-primary" id="update-preview">
                                <i class="fas fa-sync-alt"></i> Actualizar Vista Previa
                            </button>
                        </div>
                        <div class="preview-container" id="news-preview">
                            <h4 style="color: var(--primary-color); margin-bottom: 10px;">[Título de la Noticia]</h4>
                            <div style="color: #777; font-size: 0.9rem; margin-bottom: 15px;">Fecha: <span id="preview-date">Hoy</span></div>
                            <div id="preview-content">El contenido de la noticia aparecerá aquí...</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-paper-plane"></i> Publicar Noticia
                        </button>
                        <button type="button" class="btn btn-warning" id="save-draft">
                            <i class="fas fa-save"></i> Guardar Borrador
                        </button>
                        <button type="reset" class="btn btn-outline">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Vista: Gestionar Noticias -->
        <section class="content-section" id="gestionar-noticias-content">
            <div class="content-header">
                <h2><i class="fas fa-list"></i> Gestionar Noticias</h2>
                <p>Administra las noticias publicadas en el sitio web</p>
            </div>
            
            <div class="content-card">
                <h3>Noticias Publicadas</h3>
                <div class="news-list" id="news-list">
                    <!-- Las noticias se cargarán dinámicamente aquí -->
                    <div class="news-item">
                        <div class="news-item-content">
                            <div class="news-item-title">Inicio de Clases 2026</div>
                            <div class="news-item-date">Publicado: 10 Feb 2026 | Categoría: General</div>
                            <div class="news-item-preview">Damos la bienvenida a todos nuestros estudiantes al nuevo año escolar lleno de aprendizaje...</div>
                        </div>
                        <div class="news-item-actions">
                            <button class="btn btn-sm btn-primary">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                    
                    <div class="news-item">
                        <div class="news-item-content">
                            <div class="news-item-title">Reunión de Padres</div>
                            <div class="news-item-date">Publicado: 05 Feb 2026 | Categoría: Eventos</div>
                            <div class="news-item-preview">Invitamos a la comunidad educativa a la primera reunión general este viernes...</div>
                        </div>
                        <div class="news-item-actions">
                            <button class="btn btn-sm btn-primary">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" id="load-more-news">
                        <i class="fas fa-plus"></i> Cargar Más Noticias
                    </button>
                </div>
            </div>
        </section>

        <!-- Vista: Subir Documentos -->
        <section class="content-section" id="subir-documentos-content">
            <div class="content-header">
                <h2><i class="fas fa-upload"></i> Subir Documentos</h2>
                <p>Carga documentos PDF, Word o Excel para compartir en el sitio web</p>
            </div>
            
            <div class="content-card">
                <form id="upload-form">
                    <div class="form-group">
                        <label class="form-label">Seleccionar Archivo *</label>
                        <div style="border: 2px dashed #ccc; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer;" id="drop-zone">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                            <div style="font-size: 1.1rem; margin-bottom: 10px;">Arrastra y suelta archivos aquí</div>
                            <div style="color: #777; margin-bottom: 20px;">o haz clic para seleccionar</div>
                            <button type="button" class="btn btn-primary" id="browse-btn">
                                <i class="fas fa-folder-open"></i> Buscar Archivos
                            </button>
                            <input type="file" id="file-input" accept=".pdf,.doc,.docx,.xls,.xlsx" style="display: none;">
                        </div>
                    </div>
                    
                    <div id="file-info" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">Información del Archivo</label>
                            <div style="background: #f5f5f5; padding: 15px; border-radius: 6px;">
                                <div><strong>Nombre:</strong> <span id="file-name"></span></div>
                                <div><strong>Tamaño:</strong> <span id="file-size"></span></div>
                                <div><strong>Tipo:</strong> <span id="file-type"></span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Título del Documento *</label>
                        <input type="text" class="form-control" id="doc-title" placeholder="Ej: Manual de Convivencia 2026" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descripción (opcional)</label>
                        <textarea class="form-control" id="doc-desc" rows="3" placeholder="Breve descripción del documento..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Categoría</label>
                        <select class="form-control" id="doc-category">
                            <option value="academico">Académico</option>
                            <option value="administrativo">Administrativo</option>
                            <option value="normativo">Normativo</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button type="submit" class="btn btn-success" id="upload-btn" disabled>
                            <i class="fas fa-upload"></i> Subir Documento
                        </button>
                        <button type="reset" class="btn btn-outline">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Vista: Gestionar Documentos -->
        <section class="content-section" id="gestionar-documentos-content">
            <div class="content-header">
                <h2><i class="fas fa-cog"></i> Gestionar Documentos</h2>
                <p>Administra los documentos disponibles en el sitio web</p>
            </div>
            
            <div class="content-card">
                <h3>Documentos Disponibles</h3>
                <div class="docs-list" id="docs-list">
                    <!-- Los documentos se cargarán dinámicamente aquí -->
                    <div class="doc-item-admin">
                        <div class="doc-item-info">
                            <i class="fas fa-file-pdf doc-icon-admin"></i>
                            <div class="doc-details">
                                <h4>Manual de Convivencia 2026</h4>
                                <small>Categoría: Normativo | Subido: 15 Ene 2026 | Tamaño: 2.5 MB</small>
                            </div>
                        </div>
                        <div class="news-item-actions">
                            <button class="btn btn-sm btn-primary">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                            <button class="btn btn-sm btn-success">
                                <i class="fas fa-download"></i> Descargar
                            </button>
                        </div>
                    </div>
                    
                    <div class="doc-item-admin">
                        <div class="doc-item-info">
                            <i class="fas fa-file-alt doc-icon-admin"></i>
                            <div class="doc-details">
                                <h4>Horario Escolar 2026</h4>
                                <small>Categoría: Académico | Subido: 10 Ene 2026 | Tamaño: 1.2 MB</small>
                            </div>
                        </div>
                        <div class="news-item-actions">
                            <button class="btn btn-sm btn-primary">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                            <button class="btn btn-sm btn-success">
                                <i class="fas fa-download"></i> Descargar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" id="load-more-docs">
                        <i class="fas fa-plus"></i> Cargar Más Documentos
                    </button>
                </div>
            </div>
        </section>

        <!-- Vista: Oferta Académica -->
        <section class="content-section" id="oferta-academica-content">
            <div class="content-header">
                <h2><i class="fas fa-book-open"></i> Oferta Académica</h2>
                <p>Gestiona la oferta académica del colegio</p>
            </div>
            
            <div class="content-card">
                <h3>Configurar Oferta Académica</h3>
                <p>Edita el contenido que se mostrará en la sección de Oferta Académica del sitio web.</p>
                
                <div class="form-group">
                    <label class="form-label">Título Principal</label>
                    <input type="text" class="form-control" value="Oferta Académica 2026">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Descripción</label>
                    <textarea class="form-control" rows="3">Conoce los niveles educativos que ofrecemos en el Colegio El Rosario, diseñados para formar estudiantes íntegros y competitivos.</textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Niveles Educativos</label>
                    <div style="display: grid; gap: 15px; margin-top: 10px;">
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <strong>Preescolar</strong>
                                <div style="color: #777; font-size: 0.9rem;">Transición y grado 0</div>
                            </div>
                            <button class="btn btn-sm btn-primary">Editar</button>
                        </div>
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <strong>Básica Primaria</strong>
                                <div style="color: #777; font-size: 0.9rem;">Grados 1° a 5°</div>
                            </div>
                            <button class="btn btn-sm btn-primary">Editar</button>
                        </div>
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <strong>Básica Secundaria</strong>
                                <div style="color: #777; font-size: 0.9rem;">Grados 6° a 9°</div>
                            </div>
                            <button class="btn btn-sm btn-primary">Editar</button>
                        </div>
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <strong>Educación Media</strong>
                                <div style="color: #777; font-size: 0.9rem;">Grados 10° y 11°</div>
                            </div>
                            <button class="btn btn-sm btn-primary">Editar</button>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-success" style="margin-top: 20px;">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
            </div>
        </section>

        <!-- Vista: Plan de Estudios -->
        <section class="content-section" id="plan-estudios-content">
            <div class="content-header">
                <h2><i class="fas fa-calendar-alt"></i> Plan de Estudios</h2>
                <p>Administra el plan de estudios y áreas académicas</p>
            </div>
            
            <div class="content-card">
                <h3>Áreas Académicas</h3>
                
                <div style="display: grid; gap: 15px;">
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--primary-color);">Ciencias Naturales</h4>
                            <span class="btn btn-sm btn-warning">Configurar</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <div>• Biología</div>
                            <div>• Química</div>
                            <div>• Física</div>
                            <div>• Educación Ambiental</div>
                        </div>
                    </div>
                    
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid var(--secondary-color);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--secondary-color);">Matemáticas</h4>
                            <span class="btn btn-sm btn-warning">Configurar</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <div>• Aritmética</div>
                            <div>• Álgebra</div>
                            <div>• Geometría</div>
                            <div>• Estadística</div>
                        </div>
                    </div>
                    
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent-color);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0; color: #8e44ad;">Humanidades</h4>
                            <span class="btn btn-sm btn-warning">Configurar</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <div>• Lengua Castellana</div>
                            <div>• Inglés</div>
                            <div>• Filosofía</div>
                            <div>• Literatura</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" style="margin-top: 20px;">
                    <i class="fas fa-plus-circle"></i> Agregar Nueva Área
                </button>
            </div>
        </section>

        <!-- Vista: Evaluación y Promoción -->
        <section class="content-section" id="evaluacion-content">
            <div class="content-header">
                <h2><i class="fas fa-chart-bar"></i> Evaluación y Promoción</h2>
                <p>Configura los criterios de evaluación y promoción escolar</p>
            </div>
            
            <div class="content-card">
                <h3>Criterios de Evaluación</h3>
                
                <div style="display: grid; gap: 25px;">
                    <div>
                        <h4 style="margin-bottom: 15px;">Escala de Valoración</h4>
                        <div style="background: #f5f5f5; padding: 15px; border-radius: 6px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                                <span>Superior (4.6 - 5.0)</span>
                                <span style="color: green;">✓ Activo</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                                <span>Alto (4.0 - 4.5)</span>
                                <span style="color: green;">✓ Activo</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                                <span>Básico (3.0 - 3.9)</span>
                                <span style="color: green;">✓ Activo</span>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span>Bajo (0.0 - 2.9)</span>
                                <span style="color: green;">✓ Activo</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 15px;">Porcentajes por Período</h4>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                            <div style="background: #f5f5f5; padding: 15px; text-align: center; border-radius: 6px;">
                                <div style="font-weight: bold; margin-bottom: 5px;">Período 1</div>
                                <div style="font-size: 1.2rem; color: var(--primary-color);">25%</div>
                                <button class="btn btn-sm btn-primary" style="margin-top: 10px;">Editar</button>
                            </div>
                            <div style="background: #f5f5f5; padding: 15px; text-align: center; border-radius: 6px;">
                                <div style="font-weight: bold; margin-bottom: 5px;">Período 2</div>
                                <div style="font-size: 1.2rem; color: var(--primary-color);">25%</div>
                                <button class="btn btn-sm btn-primary" style="margin-top: 10px;">Editar</button>
                            </div>
                            <div style="background: #f5f5f5; padding: 15px; text-align: center; border-radius: 6px;">
                                <div style="font-weight: bold; margin-bottom: 5px;">Período 3</div>
                                <div style="font-size: 1.2rem; color: var(--primary-color);">25%</div>
                                <button class="btn btn-sm btn-primary" style="margin-top: 10px;">Editar</button>
                            </div>
                            <div style="background: #f5f5f5; padding: 15px; text-align: center; border-radius: 6px;">
                                <div style="font-weight: bold; margin-bottom: 5px;">Período 4</div>
                                <div style="font-size: 1.2rem; color: var(--primary-color);">25%</div>
                                <button class="btn btn-sm btn-primary" style="margin-top: 10px;">Editar</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-success" style="margin-top: 25px;">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
            </div>
        </section>

        <!-- Vista: Proyectos Pedagógicos -->
        <section class="content-section" id="proyectos-content">
            <div class="content-header">
                <h2><i class="fas fa-project-diagram"></i> Proyectos Pedagógicos</h2>
                <p>Gestiona los proyectos transversales y pedagógicos</p>
            </div>
            
            <div class="content-card">
                <h3>Proyectos Activos</h3>
                
                <div style="display: grid; gap: 15px;">
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: var(--primary-color);">Proyecto Ambiental Escolar - PRAE</h4>
                            <div style="color: #777;">Responsable: Comité Ambiental | Inicio: Feb 2026</div>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-primary">Editar</button>
                            <button class="btn btn-sm btn-danger">Eliminar</button>
                        </div>
                    </div>
                    
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: var(--primary-color);">Proyecto de Educación Sexual</h4>
                            <div style="color: #777;">Responsable: Psicología | Inicio: Mar 2026</div>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-primary">Editar</button>
                            <button class="btn btn-sm btn-danger">Eliminar</button>
                        </div>
                    </div>
                    
                    <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: var(--primary-color);">Proyecto de Democracia y Paz</h4>
                            <div style="color: #777;">Responsable: Área de Sociales | Inicio: Mar 2026</div>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-primary">Editar</button>
                            <button class="btn btn-sm btn-danger">Eliminar</button>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-primary" style="margin-top: 20px;">
                    <i class="fas fa-plus-circle"></i> Crear Nuevo Proyecto
                </button>
            </div>
        </section>

        <!-- Vista: Actualidad Académica -->
        <section class="content-section" id="actualidad-academica-content">
            <div class="content-header">
                <h2><i class="fas fa-bullhorn"></i> Actualidad Académica</h2>
                <p>Comparte información relevante sobre eventos y novedades académicas</p>
            </div>
            
            <div class="content-card">
                <h3>Anuncios Académicos</h3>
                
                <div style="display: grid; gap: 20px;">
                    <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; border-bottom: 3px solid var(--accent-color);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <span style="background: var(--accent-color); color: #333; padding: 3px 10px; border-radius: 20px; font-size: 0.85rem;">PRÓXIMAMENTE</span>
                                <h4 style="margin: 10px 0 5px 0;">Semana de la Ciencia 2026</h4>
                                <div style="color: #777;">Del 15 al 19 de junio</div>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-primary">Editar</button>
                            </div>
                        </div>
                        <p style="margin: 0;">Participa en la feria de proyectos científicos y talleres interactivos para todos los niveles.</p>
                    </div>
                    
                    <div style="background: #f5f5f5; padding: 20px; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <span style="background: var(--primary-color); color: white; padding: 3px 10px; border-radius: 20px; font-size: 0.85rem;">INSCRIPCIONES</span>
                                <h4 style="margin: 10px 0 5px 0;">Pruebas Saber 11°</h4>
                                <div style="color: #777;">Cierre: 30 de abril</div>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-primary">Editar</button>
                            </div>
                        </div>
                        <p style="margin: 0;">Última semana para inscribirte a las pruebas Saber 11° con acompañamiento institucional.</p>
                    </div>
                </div>
                
                <button class="btn btn-primary" style="margin-top: 20px;">
                    <i class="fas fa-plus-circle"></i> Agregar Anuncio
                </button>
            </div>
        </section>

        <!-- Vista: Configuración -->
        <section class="content-section" id="configuracion-content">
            <div class="content-header">
                <h2><i class="fas fa-cog"></i> Configuración del Sistema</h2>
                <p>Ajusta las configuraciones generales del sitio web</p>
            </div>
            
            <div class="content-card">
                <h3>Configuración General</h3>
                <form id="settings-form">
                    <div class="form-group">
                        <label class="form-label">Nombre del Colegio</label>
                        <input type="text" class="form-control" value="Colegio El Rosario">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Correo de Contacto</label>
                        <input type="email" class="form-control" value="contacto@elrosario.edu.co">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Teléfono Principal</label>
                        <input type="tel" class="form-control" value="+57 (4) 123 4567">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Máximo de Noticias en Portada</label>
                        <select class="form-control">
                            <option>3</option>
                            <option selected>5</option>
                            <option>10</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Guardar Configuración
                    </button>
                </form>
            </div>
            
            <div class="content-card">
                <h3><i class="fas fa-users-cog"></i> Usuarios Administradores</h3>
                
                <!-- Formulario crear/editar usuario -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #e0e0e0;">
                    <h4 id="usuario-form-title" style="margin: 0 0 15px 0; color: var(--primary-color);"><i class="fas fa-user-plus"></i> Agregar Nuevo Usuario</h4>
                    <form id="usuario-form">
                        <input type="hidden" id="usuario-edit-id" value="">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Nombre completo</label>
                                <input type="text" class="form-control" id="usuario-nombre" placeholder="Ej: Juan Pérez" required>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Correo electrónico</label>
                                <input type="email" class="form-control" id="usuario-email" placeholder="correo@ejemplo.com" required>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Contraseña <small id="password-hint" style="color:#777;">(obligatoria)</small></label>
                                <input type="text" class="form-control" id="usuario-password" placeholder="Contraseña del usuario">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label class="form-label">Rol</label>
                                <select class="form-control" id="usuario-rol">
                                    <option value="admin">Administrador (acceso total)</option>
                                    <option value="editor" selected>Editor (acceso limitado)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 15px; background: white; border-radius: 6px; border: 1px solid #e0e0e0;">
                            <label class="form-label" style="margin-bottom: 10px; display: block;"><i class="fas fa-shield-alt"></i> Permisos de acceso a secciones</label>
                            <div id="permisos-checkboxes" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                                <label style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f5f5f5; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                    <input type="checkbox" name="permisos" value="noticias" checked> 
                                    <i class="fas fa-newspaper" style="color: var(--primary-color);"></i> Noticias
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f5f5f5; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                    <input type="checkbox" name="permisos" value="documentos" checked> 
                                    <i class="fas fa-folder" style="color: var(--secondary-color);"></i> Documentos
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f5f5f5; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                    <input type="checkbox" name="permisos" value="academica" checked> 
                                    <i class="fas fa-graduation-cap" style="color: #e67e22;"></i> Académica
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f5f5f5; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                    <input type="checkbox" name="permisos" value="configuracion"> 
                                    <i class="fas fa-cog" style="color: #8e44ad;"></i> Configuración
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f5f5f5; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                    <input type="checkbox" name="permisos" value="docentes"> 
                                    <i class="fas fa-chalkboard-teacher" style="color: #2c3e50;"></i> Docentes
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f5f5f5; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                    <input type="checkbox" name="permisos" value="pqrs" checked> 
                                    <i class="fas fa-headset" style="color: #16a085;"></i> PQRS
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #f5f5f5; border-radius: 6px; cursor: pointer; transition: background 0.2s;">
                                    <input type="checkbox" name="permisos" value="usuarios"> 
                                    <i class="fas fa-users-cog" style="color: #c0392b;"></i> Gestión Usuarios
                                </label>
                            </div>
                        </div>

                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-success" id="usuario-submit-btn">
                                <i class="fas fa-save"></i> Crear Usuario
                            </button>
                            <button type="button" class="btn btn-secondary" id="usuario-cancel-edit" style="display: none; background: #95a5a6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-times"></i> Cancelar Edición
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Lista de usuarios -->
                <h4 style="color: var(--primary-color); margin-bottom: 15px;"><i class="fas fa-list"></i> Usuarios Registrados</h4>
                <div id="usuarios-list" style="display: grid; gap: 12px;">
                    <p style="text-align: center; color: #777; padding: 20px;">Cargando usuarios...</p>
                </div>
            </div>
        </section>

        <!-- Vista: Docentes -->
        <section class="content-section" id="docentes-content">
            <div class="content-header">
                <h2><i class="fas fa-chalkboard-teacher"></i> Gestión de Docentes</h2>
                <p>Administra el directorio de docentes de la institución</p>
            </div>
            
            <!-- Formulario para agregar docente -->
            <div class="content-card">
                <h3><i class="fas fa-user-plus"></i> Agregar Nuevo Docente</h3>
                <form id="docente-form">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label class="form-label">Nombre Completo *</label>
                            <input type="text" class="form-control" id="docente-nombre" placeholder="Ej: María García López" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Asignatura *</label>
                            <input type="text" class="form-control" id="docente-asignatura" placeholder="Ej: Matemáticas" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Correo Electrónico *</label>
                        <input type="email" class="form-control" id="docente-correo" placeholder="Ej: maria.garcia@elrosario.edu.co" required>
                    </div>
                    
                    <input type="hidden" id="docente-edit-id" value="">
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="submit" class="btn btn-success" id="docente-submit-btn">
                            <i class="fas fa-save"></i> Guardar Docente
                        </button>
                        <button type="button" class="btn btn-outline" id="docente-cancel-edit" style="display:none;">
                            <i class="fas fa-times"></i> Cancelar Edición
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Lista de docentes -->
            <div class="content-card">
                <h3><i class="fas fa-list"></i> Docentes Registrados</h3>
                <div id="docentes-admin-list" class="docs-list">
                    <div style="text-align: center; padding: 30px; color: #777;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Cargando docentes...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Vista: PQRS -->
        <section class="content-section" id="pqrs-content">
            <div class="content-header">
                <h2><i class="fas fa-headset"></i> Gestión de PQRS</h2>
                <p>Administra las Peticiones, Quejas, Reclamos y Sugerencias recibidas</p>
            </div>

            <!-- Resumen de estados -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
                <div class="content-card" style="text-align:center; padding: 20px; margin:0; cursor:pointer; transition: transform 0.2s;" onclick="filterPQRS('todos')" id="pqrs-stat-todos">
                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary-color);" id="pqrs-count-todos">0</div>
                    <div style="font-size: 0.85rem; color: #777; margin-top: 5px;">Total</div>
                </div>
                <div class="content-card" style="text-align:center; padding: 20px; margin:0; cursor:pointer; transition: transform 0.2s;" onclick="filterPQRS('pendiente')" id="pqrs-stat-pendiente">
                    <div style="font-size: 2rem; font-weight: 700; color: #e67e22;" id="pqrs-count-pendiente">0</div>
                    <div style="font-size: 0.85rem; color: #777; margin-top: 5px;">Pendientes</div>
                </div>
                <div class="content-card" style="text-align:center; padding: 20px; margin:0; cursor:pointer; transition: transform 0.2s;" onclick="filterPQRS('en_proceso')" id="pqrs-stat-en_proceso">
                    <div style="font-size: 2rem; font-weight: 700; color: #3498db;" id="pqrs-count-en_proceso">0</div>
                    <div style="font-size: 0.85rem; color: #777; margin-top: 5px;">En Proceso</div>
                </div>
                <div class="content-card" style="text-align:center; padding: 20px; margin:0; cursor:pointer; transition: transform 0.2s;" onclick="filterPQRS('resuelto')" id="pqrs-stat-resuelto">
                    <div style="font-size: 2rem; font-weight: 700; color: #27ae60;" id="pqrs-count-resuelto">0</div>
                    <div style="font-size: 0.85rem; color: #777; margin-top: 5px;">Resueltos</div>
                </div>
                <div class="content-card" style="text-align:center; padding: 20px; margin:0; cursor:pointer; transition: transform 0.2s;" onclick="filterPQRS('anulado')" id="pqrs-stat-anulado">
                    <div style="font-size: 2rem; font-weight: 700; color: #95a5a6;" id="pqrs-count-anulado">0</div>
                    <div style="font-size: 0.85rem; color: #777; margin-top: 5px;">Anulados</div>
                </div>
            </div>

            <!-- Filtro activo -->
            <div class="content-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                    <h3 style="margin:0;"><i class="fas fa-list"></i> Solicitudes <span id="pqrs-filter-label" style="font-size: 0.85rem; color: #777; font-weight: 400;">— Mostrando: Todos</span></h3>
                    <button class="btn btn-sm btn-outline" onclick="filterPQRS('todos')" id="pqrs-btn-reset" style="display:none;">
                        <i class="fas fa-times"></i> Quitar filtro
                    </button>
                </div>

                <div id="pqrs-list">
                    <div style="text-align: center; padding: 30px; color: #777;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Cargando PQRS...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modal detalle PQRS -->
        <div id="pqrs-detail-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:3000; backdrop-filter:blur(3px);">
            <div style="background:white; max-width:650px; margin:5% auto; border-radius:12px; overflow:hidden; box-shadow:0 10px 40px rgba(0,0,0,0.2); animation: modalSlideIn 0.3s ease;">
                <div id="pqrs-detail-header" style="padding:20px 25px; color:white;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h3 style="margin:0; font-size:1.1rem;" id="pqrs-detail-tipo"></h3>
                        <span style="cursor:pointer; font-size:1.5rem; line-height:1;" onclick="closePQRSDetail()">&times;</span>
                    </div>
                </div>
                <div style="padding:25px;">
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                        <div>
                            <label style="font-size:0.8rem; color:#999; text-transform:uppercase; letter-spacing:0.5px;">Nombre</label>
                            <p style="margin:4px 0 0; font-weight:600;" id="pqrs-detail-nombre"></p>
                        </div>
                        <div>
                            <label style="font-size:0.8rem; color:#999; text-transform:uppercase; letter-spacing:0.5px;">Correo</label>
                            <p style="margin:4px 0 0;" id="pqrs-detail-correo"></p>
                        </div>
                        <div>
                            <label style="font-size:0.8rem; color:#999; text-transform:uppercase; letter-spacing:0.5px;">Fecha</label>
                            <p style="margin:4px 0 0;" id="pqrs-detail-fecha"></p>
                        </div>
                        <div>
                            <label style="font-size:0.8rem; color:#999; text-transform:uppercase; letter-spacing:0.5px;">Estado actual</label>
                            <p style="margin:4px 0 0;" id="pqrs-detail-estado"></p>
                        </div>
                    </div>
                    <div style="margin-bottom:20px;">
                        <label style="font-size:0.8rem; color:#999; text-transform:uppercase; letter-spacing:0.5px;">Asunto</label>
                        <p style="margin:4px 0 0; font-weight:600; font-size:1.1rem;" id="pqrs-detail-asunto"></p>
                    </div>
                    <div style="margin-bottom:25px;">
                        <label style="font-size:0.8rem; color:#999; text-transform:uppercase; letter-spacing:0.5px;">Mensaje</label>
                        <div id="pqrs-detail-mensaje" style="margin-top:8px; padding:15px; background:#f8f9fa; border-radius:8px; border:1px solid #eee; line-height:1.6; white-space:pre-wrap;"></div>
                    </div>
                    <div style="border-top:1px solid #eee; padding-top:20px;">
                        <label style="font-size:0.8rem; color:#999; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:10px; display:block;">Cambiar estado</label>
                        <div style="display:flex; gap:8px; flex-wrap:wrap;">
                            <button class="btn btn-sm" style="background:#e67e22; color:white; border:none;" onclick="updatePQRSEstado(currentPQRSId, 'pendiente')"><i class="fas fa-clock"></i> Pendiente</button>
                            <button class="btn btn-sm" style="background:#3498db; color:white; border:none;" onclick="updatePQRSEstado(currentPQRSId, 'en_proceso')"><i class="fas fa-spinner"></i> En Proceso</button>
                            <button class="btn btn-sm" style="background:#27ae60; color:white; border:none;" onclick="updatePQRSEstado(currentPQRSId, 'resuelto')"><i class="fas fa-check-circle"></i> Resuelto</button>
                            <button class="btn btn-sm" style="background:#95a5a6; color:white; border:none;" onclick="updatePQRSEstado(currentPQRSId, 'anulado')"><i class="fas fa-ban"></i> Anulado</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ===== SISTEMA DE LOGIN =====
        (function() {
            const loginOverlay = document.getElementById('login-overlay');
            const loginForm = document.getElementById('login-form');
            const loginBtn = document.getElementById('login-btn');
            const loginError = document.getElementById('login-error');
            const loginErrorMsg = document.getElementById('login-error-msg');
            const togglePwd = document.getElementById('toggle-password');
            const pwdInput = document.getElementById('login-password');

            // Verificar si ya está logueado
            if (sessionStorage.getItem('admin_logged_in') === 'true') {
                loginOverlay.classList.add('hidden');
                const userData = JSON.parse(sessionStorage.getItem('admin_user') || '{}');
                updateUserDisplay(userData);
            }

            // Toggle mostrar/ocultar contraseña
            if (togglePwd && pwdInput) {
                togglePwd.addEventListener('click', function() {
                    const type = pwdInput.type === 'password' ? 'text' : 'password';
                    pwdInput.type = type;
                    this.querySelector('i').className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
                });
            }

            // Enviar login
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const email = document.getElementById('login-email').value.trim();
                    const password = document.getElementById('login-password').value;

                    loginBtn.disabled = true;
                    loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
                    loginError.classList.remove('show');

                    fetch('api/login.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: email, password: password })
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            sessionStorage.setItem('admin_logged_in', 'true');
                            sessionStorage.setItem('admin_user', JSON.stringify(data.user));
                            updateUserDisplay(data.user);
                            loginOverlay.classList.add('hidden');
                            // Aplicar permisos después de login
                            if (typeof applyPermissions === 'function') applyPermissions();
                        } else {
                            loginErrorMsg.textContent = data.error || 'Credenciales incorrectas';
                            loginError.classList.add('show');
                        }
                    })
                    .catch(() => {
                        loginErrorMsg.textContent = 'Error de conexión con el servidor';
                        loginError.classList.add('show');
                    })
                    .finally(() => {
                        loginBtn.disabled = false;
                        loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Iniciar Sesión';
                    });
                });
            }

            function updateUserDisplay(user) {
                if (!user) return;
                const nameEl = document.querySelector('.user-info div div[style*="font-weight"]');
                const emailEl = document.querySelector('.user-info div div[style*="font-size"]');
                if (nameEl && user.nombre) nameEl.textContent = user.nombre;
                if (emailEl && user.email) emailEl.textContent = user.email;
            }
        })();

        // ===== FUNCIONALIDAD DEL PANEL ADMINISTRATIVO =====
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            const menuLinks = document.querySelectorAll('.menu-link');
            const submenuLinks = document.querySelectorAll('.submenu-link');
            const contentSections = document.querySelectorAll('.content-section');
            
            // Toggle del menú en móvil
            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                });
            }
            
            // Cerrar menú al hacer clic fuera en móvil
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 992 && 
                    !sidebar.contains(event.target) && 
                    !menuToggle.contains(event.target)) {
                    sidebar.classList.remove('active');
                }
            });
            
            // Función para cambiar el contenido visible
            window.showContent = function(contentId) {
                console.log('Mostrando contenido:', contentId);
                
                // Ocultar todas las secciones
                contentSections.forEach(section => {
                    section.classList.remove('active');
                });
                
                // Mostrar la sección seleccionada
                const targetSection = document.getElementById(`${contentId}-content`);
                if (targetSection) {
                    targetSection.classList.add('active');
                } else {
                    console.error('No se encontró la sección:', contentId + '-content');
                }
                
                // Actualizar menú activo
                menuLinks.forEach(link => {
                    link.classList.remove('active');
                });
                
                submenuLinks.forEach(link => {
                    link.classList.remove('active');
                });
                
                // Activar enlace correspondiente
                const activeLink = document.querySelector(`[data-content="${contentId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            };
            
            // Manejar clics en enlaces del menú principal
            menuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Verificar si tiene submenú
                    if (this.parentElement.classList.contains('has-submenu')) {
                        // Toggle del submenú
                        const submenu = this.parentElement.querySelector('.submenu');
                        if (submenu) {
                            submenu.classList.toggle('show');
                            this.parentElement.classList.toggle('active');
                        }
                        return;
                    }
                    
                    const contentId = this.getAttribute('data-content');
                    if (contentId) {
                        showContent(contentId);
                    }
                    
                    // Cerrar menú en móvil
                    if (window.innerWidth <= 992) {
                        sidebar.classList.remove('active');
                    }
                });
            });
            
            // Manejar clics en submenús
            submenuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const contentId = this.getAttribute('data-content');
                    
                    if (contentId) {
                        showContent(contentId);
                        
                        // Activar el padre en el menú
                        const parentMenu = this.closest('.has-submenu');
                        if (parentMenu) {
                            menuLinks.forEach(l => l.classList.remove('active'));
                            const parentLink = parentMenu.querySelector('.menu-link');
                            if (parentLink) {
                                parentLink.classList.add('active');
                            }
                        }
                    }
                    
                    // Cerrar menú en móvil
                    if (window.innerWidth <= 992) {
                        sidebar.classList.remove('active');
                    }
                });
            });
            
            // ===== GESTIÓN DE NOTICIAS =====
            const newsForm = document.getElementById('news-form');
            const newsTitle = document.getElementById('news-title');
            const newsContent = document.getElementById('news-content');
            const updatePreviewBtn = document.getElementById('update-preview');
            const previewTitle = document.querySelector('#news-preview h4');
            const previewDate = document.getElementById('preview-date');
            const previewContent = document.getElementById('preview-content');
            
            // Actualizar vista previa
            if (updatePreviewBtn) {
                updatePreviewBtn.addEventListener('click', function() {
                    if (newsTitle) previewTitle.textContent = newsTitle.value || '[Título de la Noticia]';
                    if (newsContent) previewContent.textContent = newsContent.value || 'El contenido de la noticia aparecerá aquí...';
                    
                    const now = new Date();
                    if (previewDate) {
                        previewDate.textContent = now.toLocaleDateString('es-ES', {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric'
                        });
                    }
                });
            }
            
            // Guardar noticia - manejado por la sección de conexión BD más abajo
            
            // ===== GESTIÓN DE DOCUMENTOS =====
            const fileInput = document.getElementById('file-input');
            const dropZone = document.getElementById('drop-zone');
            const browseBtn = document.getElementById('browse-btn');
            const fileInfo = document.getElementById('file-info');
            const uploadBtn = document.getElementById('upload-btn');
            const uploadForm = document.getElementById('upload-form');
            
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            function getFileType(mimeType) {
                const types = {
                    'application/pdf': 'PDF',
                    'application/msword': 'Word',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'Word',
                    'application/vnd.ms-excel': 'Excel',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'Excel'
                };
                return types[mimeType] || mimeType;
            }
            
            function handleFileSelect(file) {
                if (!file) return;
                
                // Validar tipo de archivo
                const validTypes = ['application/pdf', 
                                  'application/msword',
                                  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                                  'application/vnd.ms-excel',
                                  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];
                
                if (!validTypes.includes(file.type)) {
                    alert('Por favor, selecciona un archivo PDF, Word o Excel.');
                    return;
                }
                
                // Mostrar información del archivo
                document.getElementById('file-name').textContent = file.name;
                document.getElementById('file-size').textContent = formatFileSize(file.size);
                document.getElementById('file-type').textContent = getFileType(file.type);
                if (fileInfo) fileInfo.style.display = 'block';
                if (uploadBtn) uploadBtn.disabled = false;
            }
            
            if (dropZone) {
                dropZone.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderColor = 'var(--primary-color)';
                    this.style.backgroundColor = '#f0f9ff';
                });
                
                dropZone.addEventListener('dragleave', function() {
                    this.style.borderColor = '#ccc';
                    this.style.backgroundColor = 'transparent';
                });
                
                dropZone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ccc';
                    this.style.backgroundColor = 'transparent';
                    
                    if (e.dataTransfer.files.length) {
                        handleFileSelect(e.dataTransfer.files[0]);
                    }
                });
            }
            
            if (browseBtn && fileInput) {
                browseBtn.addEventListener('click', function() {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', function() {
                    if (this.files.length) {
                        handleFileSelect(this.files[0]);
                    }
                });
            }
            
            // Upload de documentos - manejado por la sección de conexión BD más abajo
            
            // ===== IMAGEN DE NOTICIA - DRAG & DROP =====
            const newsImgDrop = document.getElementById('news-image-drop');
            const newsImgInput = document.getElementById('news-image');
            const newsImgPreview = document.getElementById('news-image-preview');
            const newsImgThumb = document.getElementById('news-image-thumb');
            const newsImgRemove = document.getElementById('news-image-remove');

            if (newsImgDrop && newsImgInput) {
                newsImgDrop.addEventListener('click', () => newsImgInput.click());
                
                newsImgDrop.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderColor = 'var(--primary-color)';
                    this.style.background = '#f0f9ff';
                });
                newsImgDrop.addEventListener('dragleave', function() {
                    this.style.borderColor = '#ccc';
                    this.style.background = '#fafafa';
                });
                newsImgDrop.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.borderColor = '#ccc';
                    this.style.background = '#fafafa';
                    if (e.dataTransfer.files.length) {
                        const file = e.dataTransfer.files[0];
                        if (file.type.startsWith('image/')) {
                            // Transferir archivo al input
                            const dt = new DataTransfer();
                            dt.items.add(file);
                            newsImgInput.files = dt.files;
                            showNewsImagePreview(file);
                        } else {
                            alert('Solo se permiten archivos de imagen');
                        }
                    }
                });

                newsImgInput.addEventListener('change', function() {
                    if (this.files.length) showNewsImagePreview(this.files[0]);
                });

                if (newsImgRemove) {
                    newsImgRemove.addEventListener('click', function() {
                        newsImgInput.value = '';
                        newsImgPreview.style.display = 'none';
                        newsImgDrop.style.display = 'block';
                    });
                }
            }

            function showNewsImagePreview(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    newsImgThumb.src = e.target.result;
                    newsImgPreview.style.display = 'block';
                    newsImgDrop.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }

            // ===== ARCHIVO ADJUNTO DE NOTICIA =====
            const newsAttInput = document.getElementById('news-attachment');
            const newsAttName = document.getElementById('news-attachment-name');
            const newsAttRemove = document.getElementById('news-attachment-remove');

            if (newsAttInput) {
                newsAttInput.addEventListener('change', function() {
                    if (this.files.length) {
                        newsAttName.textContent = this.files[0].name;
                        newsAttName.style.color = '#333';
                        newsAttRemove.style.display = 'inline';
                    }
                });
            }
            if (newsAttRemove) {
                newsAttRemove.addEventListener('click', function() {
                    newsAttInput.value = '';
                    newsAttName.textContent = 'Ningún archivo seleccionado';
                    newsAttName.style.color = '#777';
                    this.style.display = 'none';
                });
            }

            // Resetear previews al limpiar formulario de noticias
            if (newsForm) {
                newsForm.addEventListener('reset', function() {
                    setTimeout(() => {
                        if (newsImgPreview) newsImgPreview.style.display = 'none';
                        if (newsImgDrop) newsImgDrop.style.display = 'block';
                        if (newsAttName) { newsAttName.textContent = 'Ningún archivo seleccionado'; newsAttName.style.color = '#777'; }
                        if (newsAttRemove) newsAttRemove.style.display = 'none';
                    }, 10);
                });
            }

            // ===== BOTÓN DE SALIR =====
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    if (confirm('¿Estás seguro de que quieres salir del panel administrativo?')) {
                        sessionStorage.removeItem('admin_logged_in');
                        sessionStorage.removeItem('admin_user');
                        window.location.reload();
                    }
                });
            }
            
            // Inicializar: mostrar inicio por defecto
            showContent('inicio');

            // ===== CARGAR ESTADÍSTICAS DEL DASHBOARD =====
            function loadStats() {
                fetch('api/stats.php')
                    .then(res => res.json())
                    .then(data => {
                        document.getElementById('stat-noticias').textContent = data.noticias ?? 0;
                        document.getElementById('stat-documentos').textContent = data.documentos ?? 0;
                        document.getElementById('stat-docentes').textContent = data.docentes ?? 0;
                        document.getElementById('stat-usuarios').textContent = data.usuarios ?? 0;
                        document.getElementById('stat-pqrs').textContent = data.pqrs_pendientes ?? 0;
                    })
                    .catch(() => {});
            }
            loadStats();

            // ===== HELPER: Headers con info del usuario para logging =====
            function getUserHeaders() {
                const userData = sessionStorage.getItem('admin_user');
                const headers = { 'Content-Type': 'application/json' };
                if (userData) headers['X-User'] = userData;
                return headers;
            }

            // ===== CARGAR ACTIVIDAD RECIENTE =====
            function loadActividad() {
                const container = document.getElementById('actividad-list');
                if (!container) return;
                fetch('api/actividad.php?limit=15')
                    .then(res => res.json())
                    .then(data => {
                        if (!Array.isArray(data) || data.length === 0) {
                            container.innerHTML = '<p style="text-align:center;color:#777;padding:20px;">No hay actividad reciente.</p>';
                            return;
                        }
                        const iconMap = {
                            'noticias': { icon: 'fa-newspaper', color: 'var(--primary-color)' },
                            'documentos': { icon: 'fa-file-alt', color: '#e74c3c' },
                            'docentes': { icon: 'fa-chalkboard-teacher', color: 'var(--secondary-color)' },
                            'usuarios': { icon: 'fa-user-cog', color: '#8e44ad' },
                            'configuracion': { icon: 'fa-cog', color: '#f39c12' }
                        };
                        const tipoColors = {
                            'crear': '#27ae60',
                            'editar': '#2980b9',
                            'eliminar': '#e74c3c'
                        };
                        const tipoLabels = {
                            'crear': 'Creación',
                            'editar': 'Edición',
                            'eliminar': 'Eliminación'
                        };
                        container.innerHTML = '<ul style="list-style:none;padding:0;margin:0;">' + data.map(a => {
                            const sec = iconMap[a.seccion] || { icon: 'fa-circle', color: '#999' };
                            const fecha = formatTimeAgo(a.created_at);
                            const tipoBadge = `<span style="background:${tipoColors[a.tipo] || '#999'};color:white;padding:2px 8px;border-radius:10px;font-size:0.7rem;margin-left:5px;">${tipoLabels[a.tipo] || a.tipo}</span>`;
                            const detallesData = btoa(encodeURIComponent(JSON.stringify(a)));
                            return `
                            <li style="padding:12px 0; border-bottom:1px solid #f0f0f0; display:flex; align-items:center; justify-content:space-between; gap:10px;">
                                <div style="display:flex; align-items:center; gap:12px; flex:1; min-width:0;">
                                    <i class="fas ${sec.icon}" style="color:${sec.color}; font-size:1.1rem; flex-shrink:0;"></i>
                                    <div style="min-width:0;">
                                        <div style="font-size:0.9rem; display:flex; align-items:center; flex-wrap:wrap; gap:4px;">
                                            <span>${a.descripcion}</span>${tipoBadge}
                                        </div>
                                        <div style="font-size:0.75rem; color:#999; margin-top:3px;">
                                            <i class="fas fa-user" style="font-size:0.65rem;"></i> ${a.usuario_nombre || 'Sistema'} &bull; ${fecha}
                                        </div>
                                    </div>
                                </div>
                                <button onclick="showActividadDetalles('${detallesData}')" style="background:var(--primary-color);color:white;border:none;padding:5px 12px;border-radius:5px;cursor:pointer;font-size:0.8rem;white-space:nowrap;flex-shrink:0;">
                                    <i class="fas fa-eye"></i> Detalles
                                </button>
                            </li>`;
                        }).join('') + '</ul>';
                    })
                    .catch(() => {
                        container.innerHTML = '<p style="text-align:center;color:#e74c3c;padding:20px;">Error al cargar actividad.</p>';
                    });
            }

            function formatTimeAgo(dateStr) {
                const date = new Date(dateStr);
                const now = new Date();
                const diffMs = now - date;
                const diffMin = Math.floor(diffMs / 60000);
                const diffHrs = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffMin < 1) return 'Justo ahora';
                if (diffMin < 60) return 'Hace ' + diffMin + ' min';
                if (diffHrs < 24) return 'Hace ' + diffHrs + (diffHrs === 1 ? ' hora' : ' horas');
                if (diffDays < 7) return 'Hace ' + diffDays + (diffDays === 1 ? ' día' : ' días');
                return date.toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' });
            }

            window.showActividadDetalles = function(encodedData) {
                try {
                    const a = JSON.parse(decodeURIComponent(atob(encodedData)));
                    const modal = document.getElementById('actividad-modal');
                    const body = document.getElementById('actividad-modal-body');
                    
                    const tipoColors = { 'crear': '#27ae60', 'editar': '#2980b9', 'eliminar': '#e74c3c' };
                    const tipoLabels = { 'crear': 'Creación', 'editar': 'Edición', 'eliminar': 'Eliminación' };
                    const seccionLabels = { 'noticias': 'Noticias', 'documentos': 'Documentos', 'docentes': 'Docentes', 'usuarios': 'Usuarios', 'configuracion': 'Configuración' };
                    
                    let detallesHTML = '';
                    if (a.detalles) {
                        try {
                            const det = JSON.parse(a.detalles);
                            detallesHTML = '<div style="background:#f8f9fa;padding:12px;border-radius:8px;margin-top:15px;">' +
                                '<strong style="font-size:0.85rem;color:#555;display:block;margin-bottom:8px;"><i class="fas fa-database"></i> Datos:</strong>' +
                                Object.entries(det).map(([k, v]) => {
                                    const label = k.charAt(0).toUpperCase() + k.slice(1).replace(/_/g, ' ');
                                    const val = Array.isArray(v) ? v.join(', ') : v;
                                    return `<div style="padding:4px 0;font-size:0.85rem;"><span style="color:#777;">${label}:</span> <strong>${val || '-'}</strong></div>`;
                                }).join('') +
                                '</div>';
                        } catch(e) {
                            detallesHTML = '<div style="background:#f8f9fa;padding:12px;border-radius:8px;margin-top:15px;">' + a.detalles + '</div>';
                        }
                    }

                    const fecha = new Date(a.created_at).toLocaleString('es-ES', { day:'numeric', month:'long', year:'numeric', hour:'2-digit', minute:'2-digit' });

                    body.innerHTML = `
                        <div style="display:flex;align-items:center;gap:8px;margin-bottom:15px;">
                            <span style="background:${tipoColors[a.tipo] || '#999'};color:white;padding:4px 12px;border-radius:15px;font-size:0.85rem;font-weight:600;">${tipoLabels[a.tipo] || a.tipo}</span>
                            <span style="background:#eee;padding:4px 12px;border-radius:15px;font-size:0.85rem;">${seccionLabels[a.seccion] || a.seccion}</span>
                        </div>
                        <p style="font-size:1rem;margin:0 0 15px 0;color:#333;">${a.descripcion}</p>
                        <div style="border-top:1px solid #eee;padding-top:15px;">
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
                                <div>
                                    <div style="font-size:0.75rem;color:#999;text-transform:uppercase;">Realizado por</div>
                                    <div style="font-weight:600;margin-top:2px;">${a.usuario_nombre || 'Sistema'}</div>
                                    <div style="font-size:0.85rem;color:#777;">${a.usuario_email || '-'}</div>
                                </div>
                                <div>
                                    <div style="font-size:0.75rem;color:#999;text-transform:uppercase;">Fecha y hora</div>
                                    <div style="font-weight:600;margin-top:2px;">${fecha}</div>
                                </div>
                            </div>
                        </div>
                        ${detallesHTML}
                    `;
                    
                    modal.style.display = 'flex';
                } catch(e) {
                    alert('Error cargando detalles');
                }
            };

            window.closeActividadModal = function() {
                document.getElementById('actividad-modal').style.display = 'none';
            };

            // Cerrar modal al hacer clic fuera
            document.getElementById('actividad-modal').addEventListener('click', function(e) {
                if (e.target === this) closeActividadModal();
            });

            loadActividad();

            // ===================================================
            // ===== CONEXIÓN CON BASE DE DATOS (API PHP) =====
            // ===================================================

            // ===== DOCENTES CRUD =====
            const docenteForm = document.getElementById('docente-form');
            const docentesList = document.getElementById('docentes-admin-list');
            const docenteEditId = document.getElementById('docente-edit-id');
            const docenteCancelEdit = document.getElementById('docente-cancel-edit');
            const docenteSubmitBtn = document.getElementById('docente-submit-btn');

            function loadDocentes() {
                if (!docentesList) return;
                fetch('api/docentes.php?todos=1')
                    .then(res => res.json())
                    .then(data => {
                        if (!Array.isArray(data) || data.length === 0) {
                            docentesList.innerHTML = '<p style="text-align:center;color:#777;padding:20px;">No hay docentes registrados.</p>';
                            return;
                        }
                        docentesList.innerHTML = data.map(d => `
                            <div class="doc-item-admin" data-id="${d.id}">
                                <div class="doc-item-info">
                                    <i class="fas fa-chalkboard-teacher doc-icon-admin" style="color: ${d.estado == 1 ? 'var(--secondary-color)' : '#aaa'};"></i>
                                    <div class="doc-details">
                                        <h4>${d.nombre} ${d.estado == 0 ? '<span style="color:#e74c3c;font-size:0.8rem;">(Inactivo)</span>' : ''}</h4>
                                        <small><strong>Asignatura:</strong> ${d.asignatura} | <strong>Correo:</strong> ${d.correo}</small>
                                    </div>
                                </div>
                                <div class="news-item-actions">
                                    <button class="btn btn-sm btn-primary" onclick="editDocente(${d.id}, '${d.nombre.replace(/'/g,"\\'")}', '${d.asignatura.replace(/'/g,"\\'")}', '${d.correo}')">
                                        <i class="fas fa-edit"></i> Editar
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteDocente(${d.id}, '${d.nombre.replace(/'/g,"\\'")}')">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                </div>
                            </div>
                        `).join('');
                    })
                    .catch(() => {
                        docentesList.innerHTML = '<p style="text-align:center;color:#e74c3c;padding:20px;">Error al cargar docentes. Verifica la conexión a la base de datos.</p>';
                    });
            }

            window.editDocente = function(id, nombre, asignatura, correo) {
                document.getElementById('docente-nombre').value = nombre;
                document.getElementById('docente-asignatura').value = asignatura;
                document.getElementById('docente-correo').value = correo;
                docenteEditId.value = id;
                docenteSubmitBtn.innerHTML = '<i class="fas fa-save"></i> Actualizar Docente';
                docenteCancelEdit.style.display = 'inline-flex';
                // Scroll al formulario
                document.getElementById('docente-form').scrollIntoView({ behavior: 'smooth' });
            };

            window.deleteDocente = function(id, nombre) {
                if (!confirm('¿Estás seguro de eliminar al docente "' + nombre + '"?')) return;
                fetch('api/docentes.php', {
                    method: 'DELETE',
                    headers: getUserHeaders(),
                    body: JSON.stringify({ id: id })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Docente eliminado correctamente');
                        loadDocentes(); loadActividad(); loadStats();
                    } else {
                        alert('Error: ' + (data.error || 'No se pudo eliminar'));
                    }
                })
                .catch(() => alert('Error de conexión'));
            };

            if (docenteCancelEdit) {
                docenteCancelEdit.addEventListener('click', function() {
                    docenteForm.reset();
                    docenteEditId.value = '';
                    docenteSubmitBtn.innerHTML = '<i class="fas fa-save"></i> Guardar Docente';
                    docenteCancelEdit.style.display = 'none';
                });
            }

            if (docenteForm) {
                docenteForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const nombre = document.getElementById('docente-nombre').value.trim();
                    const asignatura = document.getElementById('docente-asignatura').value.trim();
                    const correo = document.getElementById('docente-correo').value.trim();
                    const editId = docenteEditId.value;

                    if (!nombre || !asignatura || !correo) {
                        alert('Todos los campos son obligatorios');
                        return;
                    }

                    const isEdit = editId !== '';
                    const method = isEdit ? 'PUT' : 'POST';
                    const body = { nombre, asignatura, correo };
                    if (isEdit) body.id = parseInt(editId);

                    fetch('api/docentes.php', {
                        method: method,
                        headers: getUserHeaders(),
                        body: JSON.stringify(body)
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert(isEdit ? 'Docente actualizado correctamente' : 'Docente agregado correctamente');
                            loadActividad(); loadStats();
                            docenteForm.reset();
                            docenteEditId.value = '';
                            docenteSubmitBtn.innerHTML = '<i class="fas fa-save"></i> Guardar Docente';
                            docenteCancelEdit.style.display = 'none';
                            loadDocentes();
                        } else {
                            alert('Error: ' + (data.error || 'No se pudo guardar'));
                        }
                    })
                    .catch(() => alert('Error de conexión con el servidor'));
                });
            }

            // Cargar docentes al entrar a la sección
            loadDocentes();

            // ===== NOTICIAS - CONECTAR CON BD =====
            function loadNoticiasAdmin() {
                const newsList = document.getElementById('news-list');
                if (!newsList) return;
                fetch('api/noticias.php?limit=50')
                    .then(res => res.json())
                    .then(data => {
                        if (!Array.isArray(data) || data.length === 0) {
                            newsList.innerHTML = '<p style="text-align:center;color:#777;padding:20px;">No hay noticias publicadas.</p>';
                            return;
                        }
                        newsList.innerHTML = data.map(n => {
                            const fecha = new Date(n.fecha_publicacion).toLocaleDateString('es-ES', {day:'numeric', month:'long', year:'numeric'});
                            const tieneImagen = n.imagen_url ? '<i class="fas fa-image" style="color:#27ae60;" title="Tiene imagen"></i>' : '<i class="fas fa-image" style="color:#ccc;" title="Sin imagen (se mostrará predeterminada)"></i>';
                            const tieneAdjunto = n.archivo_adjunto_ruta 
                                ? `<a href="${n.archivo_adjunto_ruta}" target="_blank" style="color:var(--primary-color);text-decoration:none;" title="${n.archivo_adjunto_nombre || 'Archivo adjunto'}"><i class="fas fa-paperclip"></i> ${n.archivo_adjunto_nombre || 'Adjunto'}</a>` 
                                : '';
                            return `
                            <div class="news-item" data-id="${n.id}">
                                <div class="news-item-content">
                                    <div class="news-item-title">${tieneImagen} ${n.titulo}</div>
                                    <div class="news-item-date">Publicado: ${fecha} | Categoría: ${n.categoria} | Estado: ${n.estado} ${tieneAdjunto ? ' | ' + tieneAdjunto : ''}</div>
                                    <div class="news-item-preview">${n.contenido.substring(0, 150)}...</div>
                                </div>
                                <div class="news-item-actions">
                                    <button class="btn btn-sm btn-danger" onclick="deleteNoticia(${n.id}, '${n.titulo.replace(/'/g,"\\'")}')">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                </div>
                            </div>`;
                        }).join('');
                    })
                    .catch(() => {});
            }

            window.deleteNoticia = function(id, titulo) {
                if (!confirm('¿Eliminar la noticia "' + titulo + '"?')) return;
                fetch('api/noticias.php', {
                    method: 'DELETE',
                    headers: getUserHeaders(),
                    body: JSON.stringify({ id: id })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Noticia eliminada');
                        loadNoticiasAdmin(); loadActividad(); loadStats();
                    }
                });
            };

            // Sobreescribir envío de noticias para usar BD
            if (newsForm) {
                newsForm.removeEventListener('submit', function(){});
                newsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const titulo = document.getElementById('news-title').value.trim();
                    const contenido = document.getElementById('news-content').value.trim();
                    const categoria = document.getElementById('news-category').value;
                    const imagenFile = document.getElementById('news-image').files[0];
                    const archivoFile = document.getElementById('news-attachment').files[0];

                    if (!titulo || !contenido) {
                        alert('Título y contenido son obligatorios');
                        return;
                    }

                    const formData = new FormData();
                    formData.append('titulo', titulo);
                    formData.append('contenido', contenido);
                    formData.append('categoria', categoria);
                    formData.append('estado', 'publicado');
                    if (imagenFile) formData.append('imagen', imagenFile);
                    if (archivoFile) formData.append('archivo_adjunto', archivoFile);

                    const uploadHeaders = {};
                    const userData = sessionStorage.getItem('admin_user');
                    if (userData) uploadHeaders['X-User'] = userData;

                    fetch('api/noticias.php', {
                        method: 'POST',
                        headers: uploadHeaders,
                        body: formData
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert('¡Noticia publicada exitosamente!');
                            newsForm.reset();
                            showContent('gestionar-noticias');
                            loadNoticiasAdmin(); loadActividad(); loadStats();
                        } else {
                            alert('Error: ' + (data.error || 'No se pudo publicar'));
                        }
                    })
                    .catch(() => alert('Error de conexión'));
                }, true);
            }

            loadNoticiasAdmin();

            // ===== DOCUMENTOS - CONECTAR CON BD =====
            function loadDocumentosAdmin() {
                const docsList = document.getElementById('docs-list');
                if (!docsList) return;
                fetch('api/documentos.php')
                    .then(res => res.json())
                    .then(data => {
                        if (!Array.isArray(data) || data.length === 0) {
                            docsList.innerHTML = '<p style="text-align:center;color:#777;padding:20px;">No hay documentos subidos.</p>';
                            return;
                        }
                        docsList.innerHTML = data.map(d => `
                            <div class="doc-item-admin" data-id="${d.id}">
                                <div class="doc-item-info">
                                    <i class="fas fa-file-pdf doc-icon-admin"></i>
                                    <div class="doc-details">
                                        <h4>${d.titulo}</h4>
                                        <small>Categoría: ${d.categoria} | Tamaño: ${d.archivo_tamano || 'N/A'}</small>
                                    </div>
                                </div>
                                <div class="news-item-actions">
                                    <button class="btn btn-sm btn-danger" onclick="deleteDocumento(${d.id}, '${d.titulo.replace(/'/g,"\\'")}')">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                    ${d.archivo_ruta ? '<a class="btn btn-sm btn-success" href="' + d.archivo_ruta + '" target="_blank"><i class="fas fa-download"></i> Descargar</a>' : ''}
                                </div>
                            </div>
                        `).join('');
                    })
                    .catch(() => {});
            }

            window.deleteDocumento = function(id, titulo) {
                if (!confirm('¿Eliminar el documento "' + titulo + '"?')) return;
                fetch('api/documentos.php', {
                    method: 'DELETE',
                    headers: getUserHeaders(),
                    body: JSON.stringify({ id: id })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Documento eliminado');
                        loadDocumentosAdmin(); loadActividad(); loadStats();
                    }
                });
            };

            // Sobreescribir upload de documentos para usar BD
            if (uploadForm) {
                uploadForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const titulo = document.getElementById('doc-title').value.trim();
                    const descripcion = document.getElementById('doc-desc').value.trim();
                    const categoria = document.getElementById('doc-category').value;
                    const archivo = fileInput.files[0];

                    if (!titulo) {
                        alert('El título es obligatorio');
                        return;
                    }

                    const formData = new FormData();
                    formData.append('titulo', titulo);
                    formData.append('descripcion', descripcion);
                    formData.append('categoria', categoria);
                    if (archivo) formData.append('archivo', archivo);

                    if (uploadBtn) {
                        uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Subiendo...';
                        uploadBtn.disabled = true;
                    }

                    const uploadHeaders = {};
                    const userData = sessionStorage.getItem('admin_user');
                    if (userData) uploadHeaders['X-User'] = userData;

                    fetch('api/documentos.php', {
                        method: 'POST',
                        headers: uploadHeaders,
                        body: formData
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert('¡Documento subido exitosamente!');
                            loadActividad(); loadStats();
                            uploadForm.reset();
                            if (fileInfo) fileInfo.style.display = 'none';
                            if (uploadBtn) {
                                uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Subir Documento';
                                uploadBtn.disabled = true;
                            }
                            showContent('gestionar-documentos');
                            loadDocumentosAdmin();
                        } else {
                            alert('Error: ' + (data.error || 'No se pudo subir'));
                            if (uploadBtn) {
                                uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Subir Documento';
                                uploadBtn.disabled = false;
                            }
                        }
                    })
                    .catch(() => {
                        alert('Error de conexión');
                        if (uploadBtn) {
                            uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Subir Documento';
                            uploadBtn.disabled = false;
                        }
                    });
                }, true);
            }

            loadDocumentosAdmin();

            // ===== USUARIOS CRUD =====
            const usuarioForm = document.getElementById('usuario-form');
            const usuariosList = document.getElementById('usuarios-list');
            const usuarioEditId = document.getElementById('usuario-edit-id');
            const usuarioCancelEdit = document.getElementById('usuario-cancel-edit');
            const usuarioSubmitBtn = document.getElementById('usuario-submit-btn');
            const usuarioFormTitle = document.getElementById('usuario-form-title');
            const passwordHint = document.getElementById('password-hint');

            function loadUsuarios() {
                if (!usuariosList) return;
                fetch('api/usuarios.php')
                    .then(res => res.json())
                    .then(data => {
                        if (!Array.isArray(data) || data.length === 0) {
                            usuariosList.innerHTML = '<p style="text-align:center;color:#777;padding:20px;">No hay usuarios registrados.</p>';
                            return;
                        }
                        usuariosList.innerHTML = data.map(u => {
                            const permisosLabels = {
                                'noticias': '<i class="fas fa-newspaper"></i> Noticias',
                                'documentos': '<i class="fas fa-folder"></i> Documentos',
                                'academica': '<i class="fas fa-graduation-cap"></i> Académica',
                                'configuracion': '<i class="fas fa-cog"></i> Configuración',
                                'docentes': '<i class="fas fa-chalkboard-teacher"></i> Docentes',
                                'usuarios': '<i class="fas fa-users-cog"></i> Usuarios'
                            };
                            const permisosHTML = (u.permisos || []).map(p => 
                                `<span style="display:inline-flex;align-items:center;gap:4px;background:#e8f5e9;color:#2e7d32;padding:2px 8px;border-radius:12px;font-size:0.75rem;">${permisosLabels[p] || p}</span>`
                            ).join(' ');
                            const estadoColor = u.activo == 1 ? 'var(--primary-color)' : '#e74c3c';
                            const estadoTexto = u.activo == 1 ? 'Activo' : 'Inactivo';
                            const rolBadge = u.rol === 'admin' 
                                ? '<span style="background:#e74c3c;color:white;padding:2px 8px;border-radius:12px;font-size:0.75rem;">Admin</span>'
                                : '<span style="background:#3498db;color:white;padding:2px 8px;border-radius:12px;font-size:0.75rem;">Editor</span>';
                            
                            return `
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid ${estadoColor};">
                                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
                                    <div style="flex: 1; min-width: 200px;">
                                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                            <i class="fas fa-user-circle" style="font-size: 1.8rem; color: ${estadoColor};"></i>
                                            <div>
                                                <strong style="font-size: 1rem;">${u.nombre}</strong> ${rolBadge}
                                                <span style="background:${estadoColor};color:white;padding:2px 8px;border-radius:12px;font-size:0.75rem;margin-left:5px;">${estadoTexto}</span>
                                                <div style="color: #777; font-size: 0.85rem;">${u.email}</div>
                                            </div>
                                        </div>
                                        <div style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 5px;">
                                            ${permisosHTML || '<span style="color:#999;font-size:0.8rem;">Sin permisos asignados</span>'}
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 8px;">
                                        <button class="btn btn-sm btn-primary" onclick="editUsuario(${u.id})" style="padding: 6px 12px;">
                                            <i class="fas fa-edit"></i> Editar
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteUsuario(${u.id}, '${u.nombre.replace(/'/g,"\\'")}')" style="padding: 6px 12px;">
                                            <i class="fas fa-trash"></i> Eliminar
                                        </button>
                                    </div>
                                </div>
                            </div>`;
                        }).join('');
                    })
                    .catch(() => {
                        usuariosList.innerHTML = '<p style="text-align:center;color:#e74c3c;padding:20px;">Error al cargar usuarios.</p>';
                    });
            }

            window.editUsuario = function(id) {
                fetch('api/usuarios.php?id=' + id)
                    .then(res => res.json())
                    .then(u => {
                        if (u.error) { alert(u.error); return; }
                        document.getElementById('usuario-nombre').value = u.nombre;
                        document.getElementById('usuario-email').value = u.email;
                        document.getElementById('usuario-password').value = '';
                        document.getElementById('usuario-rol').value = u.rol;
                        usuarioEditId.value = u.id;

                        // Marcar checkboxes de permisos
                        document.querySelectorAll('input[name="permisos"]').forEach(cb => {
                            cb.checked = (u.permisos || []).includes(cb.value);
                        });

                        usuarioFormTitle.innerHTML = '<i class="fas fa-user-edit"></i> Editando Usuario: ' + u.nombre;
                        usuarioSubmitBtn.innerHTML = '<i class="fas fa-save"></i> Actualizar Usuario';
                        passwordHint.textContent = '(dejar vacío para no cambiar)';
                        usuarioCancelEdit.style.display = 'inline-flex';
                        
                        document.getElementById('usuario-form').scrollIntoView({ behavior: 'smooth' });
                    })
                    .catch(() => alert('Error cargando datos del usuario'));
            };

            window.deleteUsuario = function(id, nombre) {
                if (!confirm('¿Estás seguro de eliminar al usuario "' + nombre + '"?\n\nEsta acción no se puede deshacer.')) return;
                fetch('api/usuarios.php', {
                    method: 'DELETE',
                    headers: getUserHeaders(),
                    body: JSON.stringify({ id: id })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Usuario eliminado correctamente');
                        loadUsuarios(); loadActividad(); loadStats();
                    } else {
                        alert('Error: ' + (data.error || 'No se pudo eliminar'));
                    }
                })
                .catch(() => alert('Error de conexión'));
            };

            if (usuarioCancelEdit) {
                usuarioCancelEdit.addEventListener('click', function() {
                    usuarioForm.reset();
                    usuarioEditId.value = '';
                    usuarioFormTitle.innerHTML = '<i class="fas fa-user-plus"></i> Agregar Nuevo Usuario';
                    usuarioSubmitBtn.innerHTML = '<i class="fas fa-save"></i> Crear Usuario';
                    passwordHint.textContent = '(obligatoria)';
                    usuarioCancelEdit.style.display = 'none';
                    // Restaurar checkboxes por defecto
                    document.querySelectorAll('input[name="permisos"]').forEach(cb => {
                        cb.checked = ['noticias', 'documentos', 'academica'].includes(cb.value);
                    });
                });
            }

            if (usuarioForm) {
                usuarioForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const nombre = document.getElementById('usuario-nombre').value.trim();
                    const email = document.getElementById('usuario-email').value.trim();
                    const password = document.getElementById('usuario-password').value;
                    const rol = document.getElementById('usuario-rol').value;
                    const editId = usuarioEditId.value;
                    const isEdit = editId !== '';

                    // Obtener permisos seleccionados
                    const permisos = [];
                    document.querySelectorAll('input[name="permisos"]:checked').forEach(cb => {
                        permisos.push(cb.value);
                    });

                    if (!nombre || !email) {
                        alert('Nombre y correo son obligatorios');
                        return;
                    }

                    if (!isEdit && !password) {
                        alert('La contraseña es obligatoria para nuevos usuarios');
                        return;
                    }

                    const body = { nombre, email, rol, permisos, activo: 1 };
                    if (password) body.password = password;
                    if (isEdit) body.id = parseInt(editId);

                    fetch('api/usuarios.php', {
                        method: isEdit ? 'PUT' : 'POST',
                        headers: getUserHeaders(),
                        body: JSON.stringify(body)
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            alert(isEdit ? 'Usuario actualizado correctamente' : 'Usuario creado correctamente');
                            loadActividad(); loadStats();
                            usuarioForm.reset();
                            usuarioEditId.value = '';
                            usuarioFormTitle.innerHTML = '<i class="fas fa-user-plus"></i> Agregar Nuevo Usuario';
                            usuarioSubmitBtn.innerHTML = '<i class="fas fa-save"></i> Crear Usuario';
                            passwordHint.textContent = '(obligatoria)';
                            usuarioCancelEdit.style.display = 'none';
                            document.querySelectorAll('input[name="permisos"]').forEach(cb => {
                                cb.checked = ['noticias', 'documentos', 'academica'].includes(cb.value);
                            });
                            loadUsuarios();
                        } else {
                            alert('Error: ' + (data.error || 'No se pudo guardar'));
                        }
                    })
                    .catch(() => alert('Error de conexión con el servidor'));
                });
            }

            loadUsuarios();

            // ===== GESTIÓN DE PQRS =====
            let allPQRS = [];
            let currentPQRSFilter = 'todos';
            window.currentPQRSId = null;

            function loadPQRS() {
                fetch('api/pqrs.php')
                    .then(res => res.json())
                    .then(data => {
                        if (!Array.isArray(data)) { allPQRS = []; } else { allPQRS = data; }
                        updatePQRSStats();
                        renderPQRSList();
                    })
                    .catch(() => {
                        document.getElementById('pqrs-list').innerHTML = '<p style="text-align:center;color:#c0392b;padding:20px;">Error al cargar PQRS.</p>';
                    });
            }

            function updatePQRSStats() {
                const counts = { todos: allPQRS.length, pendiente: 0, en_proceso: 0, resuelto: 0, anulado: 0 };
                allPQRS.forEach(p => { if (counts[p.estado] !== undefined) counts[p.estado]++; });
                Object.keys(counts).forEach(k => {
                    const el = document.getElementById('pqrs-count-' + k);
                    if (el) el.textContent = counts[k];
                });
            }

            function renderPQRSList() {
                const container = document.getElementById('pqrs-list');
                const label = document.getElementById('pqrs-filter-label');
                const resetBtn = document.getElementById('pqrs-btn-reset');

                let filtered = currentPQRSFilter === 'todos' ? allPQRS : allPQRS.filter(p => p.estado === currentPQRSFilter);

                const labelMap = { todos: 'Todos', pendiente: 'Pendientes', en_proceso: 'En Proceso', resuelto: 'Resueltos', anulado: 'Anulados' };
                label.textContent = '— Mostrando: ' + (labelMap[currentPQRSFilter] || 'Todos') + ' (' + filtered.length + ')';
                resetBtn.style.display = currentPQRSFilter === 'todos' ? 'none' : 'inline-flex';

                // Highlight active stat card
                document.querySelectorAll('[id^="pqrs-stat-"]').forEach(el => {
                    el.style.border = el.id === 'pqrs-stat-' + currentPQRSFilter ? '2px solid var(--primary-color)' : '';
                    el.style.transform = el.id === 'pqrs-stat-' + currentPQRSFilter ? 'scale(1.03)' : '';
                });

                if (filtered.length === 0) {
                    container.innerHTML = '<p style="text-align:center;color:#777;padding:30px;">No hay PQRS ' + (currentPQRSFilter !== 'todos' ? 'con estado "' + labelMap[currentPQRSFilter] + '"' : 'registradas') + '.</p>';
                    return;
                }

                container.innerHTML = filtered.map(p => {
                    const fecha = new Date(p.created_at).toLocaleDateString('es-ES', {day:'numeric', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit'});
                    const estadoColors = { pendiente: '#e67e22', en_proceso: '#3498db', resuelto: '#27ae60', anulado: '#95a5a6' };
                    const estadoLabels = { pendiente: 'Pendiente', en_proceso: 'En Proceso', resuelto: 'Resuelto', anulado: 'Anulado' };
                    const estadoIcons = { pendiente: 'fa-clock', en_proceso: 'fa-spinner', resuelto: 'fa-check-circle', anulado: 'fa-ban' };
                    const tipoColors = { Peticion: '#3498db', Queja: '#e74c3c', Reclamo: '#e67e22', Sugerencia: '#27ae60' };

                    return `
                    <div style="display:flex; align-items:center; padding:15px; border:1px solid #eee; border-radius:8px; margin-bottom:10px; transition: all 0.2s; cursor:pointer; border-left: 4px solid ${estadoColors[p.estado] || '#ccc'};" 
                         onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.08)'" onmouseout="this.style.boxShadow='none'"
                         onclick="showPQRSDetail(${p.id})">
                        <div style="flex:1; min-width:0;">
                            <div style="display:flex; align-items:center; gap:10px; margin-bottom:6px; flex-wrap:wrap;">
                                <span style="background:${tipoColors[p.tipo] || '#777'}; color:white; padding:2px 10px; border-radius:20px; font-size:0.75rem; font-weight:600;">${p.tipo}</span>
                                <span style="background:${estadoColors[p.estado]}22; color:${estadoColors[p.estado]}; padding:2px 10px; border-radius:20px; font-size:0.75rem; font-weight:600;">
                                    <i class="fas ${estadoIcons[p.estado]}"></i> ${estadoLabels[p.estado]}
                                </span>
                                <span style="color:#999; font-size:0.8rem;">${fecha}</span>
                            </div>
                            <div style="font-weight:600; margin-bottom:4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${p.asunto}</div>
                            <div style="color:#777; font-size:0.85rem;">${p.nombre} — ${p.correo}</div>
                        </div>
                        <div style="margin-left:15px; display:flex; gap:6px; flex-shrink:0;">
                            <button class="btn btn-sm btn-outline" onclick="event.stopPropagation(); showPQRSDetail(${p.id})" title="Ver detalle">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deletePQRS(${p.id}, '${p.asunto.replace(/'/g, "\\'")}')" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>`;
                }).join('');
            }

            window.filterPQRS = function(estado) {
                currentPQRSFilter = estado;
                renderPQRSList();
            };

            window.showPQRSDetail = function(id) {
                const p = allPQRS.find(x => x.id == id);
                if (!p) return;

                currentPQRSId = p.id;
                const fecha = new Date(p.created_at).toLocaleDateString('es-ES', {day:'numeric', month:'long', year:'numeric', hour:'2-digit', minute:'2-digit'});
                const tipoColors = { Peticion: '#3498db', Queja: '#e74c3c', Reclamo: '#e67e22', Sugerencia: '#27ae60' };
                const estadoColors = { pendiente: '#e67e22', en_proceso: '#3498db', resuelto: '#27ae60', anulado: '#95a5a6' };
                const estadoLabels = { pendiente: 'Pendiente', en_proceso: 'En Proceso', resuelto: 'Resuelto', anulado: 'Anulado' };

                document.getElementById('pqrs-detail-header').style.background = tipoColors[p.tipo] || '#333';
                document.getElementById('pqrs-detail-tipo').innerHTML = '<i class="fas fa-tag"></i> ' + p.tipo + ' #' + p.id;
                document.getElementById('pqrs-detail-nombre').textContent = p.nombre;
                document.getElementById('pqrs-detail-correo').textContent = p.correo;
                document.getElementById('pqrs-detail-fecha').textContent = fecha;
                document.getElementById('pqrs-detail-estado').innerHTML = '<span style="background:' + estadoColors[p.estado] + '22; color:' + estadoColors[p.estado] + '; padding:3px 12px; border-radius:20px; font-size:0.85rem; font-weight:600;">' + estadoLabels[p.estado] + '</span>';
                document.getElementById('pqrs-detail-asunto').textContent = p.asunto;
                document.getElementById('pqrs-detail-mensaje').textContent = p.mensaje;

                document.getElementById('pqrs-detail-modal').style.display = 'block';
            };

            window.closePQRSDetail = function() {
                document.getElementById('pqrs-detail-modal').style.display = 'none';
                currentPQRSId = null;
            };

            document.getElementById('pqrs-detail-modal').addEventListener('click', function(e) {
                if (e.target === this) closePQRSDetail();
            });

            window.updatePQRSEstado = function(id, estado) {
                fetch('api/pqrs.php', {
                    method: 'PUT',
                    headers: getUserHeaders(),
                    body: JSON.stringify({ id: id, estado: estado })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        closePQRSDetail();
                        loadPQRS();
                        loadActividad();
                    } else {
                        alert('Error: ' + (data.error || 'No se pudo actualizar'));
                    }
                })
                .catch(() => alert('Error de conexión'));
            };

            window.deletePQRS = function(id, asunto) {
                if (!confirm('¿Eliminar la PQRS "' + asunto + '"? Esta acción no se puede deshacer.')) return;
                fetch('api/pqrs.php', {
                    method: 'DELETE',
                    headers: getUserHeaders(),
                    body: JSON.stringify({ id: id })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        loadPQRS();
                        loadActividad();
                        loadStats();
                    } else {
                        alert('Error: ' + (data.error || 'No se pudo eliminar'));
                    }
                })
                .catch(() => alert('Error de conexión'));
            };

            loadPQRS();

            // ===== SISTEMA DE PERMISOS: Ocultar secciones según permisos del usuario =====
            window.applyPermissions = function() {
                const userData = sessionStorage.getItem('admin_user');
                if (!userData) return;
                
                const user = JSON.parse(userData);
                const permisos = user.permisos || [];
                
                // Si es admin, mostrar todo
                if (user.rol === 'admin') return;
                
                // Mapeo de permisos a los data-content del sidebar
                const permissionMap = {
                    'noticias': ['noticias', 'publicar-noticia', 'gestionar-noticias'],
                    'documentos': ['documentos', 'subir-documentos', 'gestionar-documentos'],
                    'academica': ['academica', 'oferta-academica', 'plan-estudios', 'evaluacion', 'proyectos', 'actualidad-academica'],
                    'configuracion': ['configuracion'],
                    'docentes': ['gestion-admin', 'docentes'],
                    'usuarios': ['configuracion'],
                    'pqrs': ['pqrs']
                };

                // Recopilar todos los data-content permitidos
                const allowedContents = new Set(['inicio']); // Inicio siempre visible
                permisos.forEach(perm => {
                    const contents = permissionMap[perm] || [];
                    contents.forEach(c => allowedContents.add(c));
                });

                // Ocultar menús no permitidos
                document.querySelectorAll('.menu-item').forEach(item => {
                    const link = item.querySelector('.menu-link');
                    if (!link) return;
                    const contentId = link.getAttribute('data-content');
                    if (!contentId) return;
                    
                    if (!allowedContents.has(contentId)) {
                        item.style.display = 'none';
                    } else {
                        item.style.display = '';
                    }
                });
            }

            applyPermissions();
        });
    </script>
</body>
</html>